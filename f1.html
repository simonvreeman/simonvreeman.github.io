<!doctype html>
<html lang="en">
  <head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-WKSDWK');</script>
  </head>
  <body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WKSDWK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>
      googleTrack = function(data){
        var ua = 'UA-2826482-22';
        if (typeof ga === 'function') {
          console.log('GA Loaded');
          if ( navigator.userAgent.toLowerCase().indexOf('googlebot') > -1 ){
            $.getJSON('//freegeoip.net/json/?callback=?', function(data) {
              Object.defineProperty(document, "referrer", {
                get : function(){
                  return "notgoogle.com";
                }
              });
              var url = window.location.href;
              var city = data.city;
              var state = data.region_code;
              var ip = data.ip;
              
              ga('create', ua , 'auto');
              ga('send', {
                hitType: 'event',
                eventCategory: 'Googlebot',
                eventAction: url,
                eventLabel:  ip + " : " + city + ", " + state
              });
              console.log('GA hit sent');
            });
          }
        } else {
          console.log('GA Not loaded');
          setTimeout( function(){ googleTrack(); }, 500 );
        }
      }
      googleTrack();
    </script>
  </body>
</html>