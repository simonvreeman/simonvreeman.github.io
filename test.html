<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, shrink-to-fit=no">
    <title>Test</title>
    <script src="https://www.googletagmanager.com/gtag/js?id=UA-2826482-20" async></script>
    <script>
      var ua = navigator.userAgent || navigator.vendor || window.opera;
      var fs = window.RequestFileSystem || window.webkitRequestFileSystem;
      var ref = document.referrer;
      var memory = navigator.deviceMemory || navigator.hardwareConcurrency || '(not set)';

      function hitCallback() {
        var gaclientid = ga.getAll()[0].get('clientId');
        document.getElementById("clientid").innerHTML = gaclientid;
        gtag('event', 'clientid', {
          'event_category': 'Client ID',
          'event_action': gaclientid,
          'clientidsession': gaclientid,
          'clientiduser': gaclientid
        });
      }

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments)};
      gtag('js', new Date());
      gtag('config', 'UA-2826482-20', {
        'custom_map': {
          'dimension2': 'clientidsession',
          'dimension6': 'referrer',
          'dimension7': 'clientiduser',
          'dimension8': 'fingerprint',
          'dimension9': 'browsermode',
          'dimension10': 'useragent',
          'dimension11': 'devicememory'
        },
        'transport_type': 'beacon',
        'link_attribution': false,
        'allow_display_features': false,
        'anonymize_ip': true,
        'linker': {
          'accept_incoming': true,
          'domains': ['vreeman.com', 'simonvreeman.com', 'simonvreeman.nl']
        },
        'sampleRate': 100,
        'siteSpeedSampleRate': 100,
        'useAmpClientId': true,
        'page_path': '/test.html',
        'referrer': ref,
        'useragent': ua,
        'devicememory': memory
      });

      gtag('event', 'test_action', {
        'event_category': 'test_category',
        'event_label': 'test_label',
        'value': 10,
        'non_interaction': true,
        event_callback: hitCallback
      });
    </script>
    <style>
      body {
        font: 1.125em/1.6 BlinkMacSystemFont, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      }
      dt {
        font-weight: 700;
      }
      code {
        font-family: monospace, monospace;
        font-size: 1em;
      }
    </style>
    <link rel="canonical" href="https://vreeman.com/">
    <meta name="referrer" content="no-referrer">
    <meta name="robots" content="noindex, nofollow">
  </head>
  <body>
    <dl>
      <dt>navigator.userAgent:</dt>
      <dd><code id="ua"></code></dd>
      <dt>document.referrer:</dt>
      <dd><code id="ref"></code></dd>
      <dt>Google Analytics Client ID:</dt>
      <dd><code id="clientid"></code></dd>
      <dt>Fingerprintjs2:</dt>
      <dd><code id="fingerprint"></code></dd>
      <dt>window.performance.now:</dt>
      <dd><code id="window-performance"></code></dd>
      <dt>Browser Mode</dt>
      <dd><code id="browser-mode"></code></dd>
      <dt>Device Memory</dt>
      <dd><code id="device-memory"></code></dd>
      <dt>In-app browser:</dt>
      <dd><code id="in-app"></code></dd>
    </dl>
    <details>
      <summary>navigator.connection&hellip;</summary>
      <ul>
        <script>
          for (a in navigator.connection) {
            document.write('<li><strong>navigator.' + a + '</strong>: <code>' + navigator.connection[a] + '</code></li>');
          }
        </script>
      </ul>
    </details>
    <details>
      <summary>window.performance&hellip;</summary>
      <ul>
        <script>
          for (b in window.performance.timing) {
            document.write('<li><strong>window.' + b + '</strong>: <code>' + window.performance.timing[b] + '</code></li>');
          }
        </script>
      </ul>
    </details>
    <details>
      <summary>Width / Height&hellip;</summary>
      <dl>
        <dt>Total screen width/height:</dt>
        <dd><code><script>document.write( screen.width + ' &times; ' + screen.height );</script></code></dd>
        <dt>Available screen width/height:</dt>
        <dd><code><script>document.write( screen.availWidth + ' &times; ' + screen.availHeight );</script></code></dd>
        <dt>Total browser width/height:</dt>
        <dd><code><script>document.write( window.outerWidth + ' &times; ' + window.outerHeight );</script></code></dd>
        <dt>Available browser width/height:</dt>
        <dd><code><script>document.write( window.innerWidth + ' &times; ' + window.innerHeight );</script></code></dd>
      </dl>
    </details>
    <details>
      <summary>Fingerprint2</summary>
      <ul id="components">
        <li><strong></strong>: <code></code></li>
      </ul>
    </details>
    <p><small>Some tests by <a href="https://vreeman.com" rel="noopener" onclick="gtag('event', 'link_click', { 'event_category': 'Link click', 'event_action': 'Simon Vreeman', 'event_label': 'https://vreeman.com', 'non_interaction': true } );">Simon Vreeman</a>.</small></p>
    <script src="js/engagement.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fingerprintjs2@1/dist/fingerprint2.min.js"></script>
    <script>
      function retry(isDone, next) {
        var current_trial = 0, max_retry = 50, interval = 10, is_timeout = false;
        var id = window.setInterval(
          function() {
            if (isDone()) {
              window.clearInterval(id);
              next(is_timeout);
            }
            if (current_trial++ > max_retry) {
              window.clearInterval(id);
              is_timeout = true;
              next(is_timeout);
            }
          },
          10
        );
      }
      function isIE10OrLater(user_agent) {
        var ua = user_agent.toLowerCase();
        if (ua.indexOf('msie') === 0 && ua.indexOf('trident') === 0) {
          return false;
        }
        var match = /(?:msie|rv:)\s?([\d\.]+)/.exec(ua);
        if (match && parseInt(match[1], 10) >= 10) {
          return true;
        }
        return false;
      }
      function detectPrivateMode(callback) {
        var is_private;
        if (window.webkitRequestFileSystem) {
          window.webkitRequestFileSystem(
            window.TEMPORARY, 1,
            function() {
              is_private = false;
            },
            function(e) {
              // console.log(e);
              is_private = true;
            }
          );
        } else if (window.indexedDB && /Firefox/.test(window.navigator.userAgent)) {
          var db;
          try {
            db = window.indexedDB.open('test');
          } catch(e) {
            is_private = true;
          }
          if (typeof is_private === 'undefined') {
            retry(
              function isDone() {
                return db.readyState === 'done' ? true : false;
              },
              function next(is_timeout) {
                if (!is_timeout) {
                  is_private = db.result ? false : true;
                }
              }
            );
          }
        } else if (isIE10OrLater(window.navigator.userAgent)) {
          is_private = false;
          try {
            if (!window.indexedDB) {
              is_private = true;
            }
          } catch (e) {
            is_private = true;
          }
        } else if (window.localStorage && /Safari/.test(window.navigator.userAgent)) {
          try {
            window.localStorage.setItem('test', 1);
          } catch(e) {
            is_private = true;
          }
          if (typeof is_private === 'undefined') {
            is_private = false;
            window.localStorage.removeItem('test');
          }
        }
        retry(
          function isDone() {
            return typeof is_private !== 'undefined' ? true : false;
          },
          function next(is_timeout) {
            callback(is_private);
          }
        );
      }
      detectPrivateMode(
        function(is_private) {
          document.getElementById('browser-mode').innerHTML = typeof is_private === 'undefined' ? 'Cannot Detect' : is_private ? 'Private' : 'Not Private';

          gtag('event', 'Browser mode', {
            'event_category': 'Engagement',
            'event_label': typeof is_private === 'undefined' ? 'Cannot Detect' : is_private ? 'Private' : 'Not Private',
            'browsermode': typeof is_private === 'undefined' ? 'Cannot Detect' : is_private ? 'Private' : 'Not Private'
          });
        }
      );

      // Fingerprint2
      var options = {excludeJsFonts: true, excludeCanvas: true, excludeWebGL: true, detectScreenOrientation: true};
      new Fingerprint2(options).get(function(result, components){
        document.getElementById("fingerprint").innerHTML = result;
        document.getElementById("components").innerHTML = components;
        // console.log(result);
        // console.log(components);
        var details = '';

        for (var index in components) {
          var obj = components[index];
          var key = obj.key;
          var value = obj.value;
          var line = '<li><strong>' + key + '</strong>: <code>' + value.toString() + '</code></li>';
          details += line;
        }
        document.getElementById("components").innerHTML = details;

        gtag('event', 'fingerprint', {
          'event_category': 'Fingerprint',
          'event_action': result,
          'fingerprint': result
        });
      });

      var currentUrl = window.location.href;
      var getUrlParameters = Object.assign(...currentUrl.match(/([^?=&]+)(=([^&]*))?/g).map(m => {[f,v] = m.split('='); return {[f]:v}}));
      // console.log( getUrlParameters );

      // Check Facebook, LinkedIn, Twitter or Flipboard In-App browsers
      var fbinapp = (ua.indexOf("FBAN/FBIOS") > -1) || (ua.indexOf("FB_IAB/FB4A") > -1) ? 'Yes' : 'No';
      var liinapp = (ua.indexOf("LinkedIn") > -1) ? 'Yes' : 'No';
      var twinapp = (ua.indexOf("Twitter") > -1) ? 'Yes' : 'No';
      var flinapp = (ua.indexOf("Flipboard") > -1) ? 'Yes' : 'No';
      document.getElementById("in-app").innerHTML = "Facebook: " + fbinapp + ", LinkedIn: " + liinapp + ", Twitter: " + twinapp + ", Flipboard: " + flinapp;
      document.getElementById("ua").innerHTML = ua;
      document.getElementById("ref").innerHTML = ref;
      document.getElementById("device-memory").innerHTML = memory + ' RAM(GiB)';

      // Feature detects Navigation Timing API support.
      if (window.performance) {
        // Gets the number of milliseconds since page load
        // (and rounds the result since the value must be an integer).
        var timeSincePageLoad = Math.round(performance.now());
        document.getElementById("window-performance").innerHTML = timeSincePageLoad;
        // console.log(window.performance);
        // console.log(navigator.connection);

        gtag('event', 'timing_complete', {
          'name': 'load',
          'value': timeSincePageLoad,
          'event_category': 'JS Dependencies'
        });
      }
    </script>
  </body>
</html>