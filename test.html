<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, shrink-to-fit=no, viewport-fit=cover">
    <title>Test</title>
    <script>var host="vreeman.com";host==window.location.host&&"https:"!=window.location.protocol&&(window.location.protocol="https");</script>
    <script src="https://www.googletagmanager.com/gtag/js?id=UA-2826482-20" async></script>
    <script>
      var ua = navigator.userAgent || navigator.vendor || window.opera;
      var fs = window.RequestFileSystem || window.webkitRequestFileSystem;
      var ref = document.referrer;

      function hitCallback() {
        var gaclientid = ga.getAll()[0].get('clientId');
        document.getElementById("clientid").innerHTML = gaclientid;
        gtag('event', 'clientid', {
          'event_category': 'Client ID',
          'event_action': gaclientid,
          'clientidsession': gaclientid,
          'clientiduser': gaclientid
        });
      }

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments)};
      gtag('js', new Date());
      gtag('config', 'UA-2826482-20', {
        'custom_map': {
          'dimension2': 'clientidsession',
          'dimension6': 'referrer',
          'dimension7': 'clientiduser',
          'dimension8': 'fingerprint',
          'dimension10': 'useragent'
        },
        'transport_type': 'beacon',
        'link_attribution': true,
        'anonymize_ip': true,
        'linker': {
          'accept_incoming': true,
          'domains': ['vreeman.com', 'simonvreeman.com', 'simonvreeman.nl']
        },
        'sampleRate': 100,
        'siteSpeedSampleRate': 100,
        'useAmpClientId': true,
        'page_path': '/test.html',
        'referrer': ref,
        'useragent': ua
      });

      gtag('event', 'test_action', {
        'event_category': 'test_category',
        'event_label': 'test_label',
        'value': 10,
        'non_interaction': true,
        event_callback: hitCallback
      });
    </script>
    <style>
      body {
        padding-top: constant(safe-area-inset-top);
        padding-left: constant(safe-area-inset-left);
        padding-bottom: constant(safe-area-inset-bottom);
        padding-right: constant(safe-area-inset-right);
        font: 1.125em/1.6 BlinkMacSystemFont, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      }
      dt {
        font-weight: 700;
      }
      code {
        font-family: monospace, monospace;
        font-size: 1em;
      }
    </style>
    <link rel="canonical" href="https://vreeman.com/">
    <meta name="referrer" content="no-referrer">
    <meta name="robots" content="noindex, nofollow">
  </head>
  <body>
    <dl>
      <dt>navigator.userAgent:</dt>
      <dd><code id="ua"></code></dd>
      <dt>document.referrer:</dt>
      <dd><code id="ref"></code></dd>
      <dt>Google Analytics Client ID:</dt>
      <dd><code id="clientid"></code></dd>
      <dt>Fingerprintjs2:</dt>
      <dd><code id="fingerprint"></code></dd>
      <dt>window.performance.now:</dt>
      <dd><code id="window-performance"></code></dd>
      <dt>Browser Mode</dt>
      <dd><code id="browser-mode"></code> | <code id="browser-mode1"></code></dd>
      <dt>In-app browser:</dt>
      <dd><code id="in-app"></code></dd>
    </dl>
    <details>
      <summary>navigator.connection</summary>
      <ul>
        <script>
          for (a in navigator.connection) {
            document.write('<li><strong>navigator.' + a + '</strong>: <code>' + navigator.connection[a] + '</code></li>');
          }
        </script>
      </ul>
    </details>
    <details>
      <summary>More&hellip;</summary>
      <dl>
        <dt>Total screen width/height:</dt>
        <dd><code><script>document.write( screen.width + ' &times; ' + screen.height );</script></code></dd>
        <dt>Available screen width/height:</dt>
        <dd><code><script>document.write( screen.availWidth + ' &times; ' + screen.availHeight );</script></code></dd>
        <dt>Total browser width/height:</dt>
        <dd><code><script>document.write( window.outerWidth + ' &times; ' + window.outerHeight );</script></code></dd>
        <dt>Available browser width/height:</dt>
        <dd><code><script>document.write( window.innerWidth + ' &times; ' + window.innerHeight );</script></code></dd>
      </dl>
    </details>
    <p><small>Some tests by <a href="https://vreeman.com" rel="noopener" onclick="gtag('event', 'link_click', { 'event_category': 'Link click', 'event_action': 'Simon Vreeman', 'event_label': 'https://vreeman.com', 'non_interaction': true } );">Simon Vreeman</a>.</small></p>
    <script src="js/engagement.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fingerprintjs2@1/dist/fingerprint2.min.js"></script>
    <script>
      // Fingerprint2
      new Fingerprint2().get(function(result, components){
        document.getElementById("fingerprint").innerHTML = result;
        console.log(result);
        console.log(components);

        gtag('event', 'fingerprint', {
          'event_category': 'Fingerprint',
          'event_action': result,
          'fingerprint': result
        });
      });

      // Check Facebook, LinkedIn, Twitter or Flipboard In-App browsers
      var fbinapp = (ua.indexOf("FBAN/FBIOS") > -1) || (ua.indexOf("FB_IAB/FB4A") > -1) ? 'Yes' : 'No';
      var liinapp = (ua.indexOf("LinkedIn") > -1) ? 'Yes' : 'No';
      var twinapp = (ua.indexOf("Twitter") > -1) ? 'Yes' : 'No';
      var flinapp = (ua.indexOf("Flipboard") > -1) ? 'Yes' : 'No';
      document.getElementById("in-app").innerHTML = "Facebook: " + fbinapp + ", LinkedIn: " + liinapp + ", Twitter: " + twinapp + ", Flipboard: " + flinapp;
      document.getElementById("ua").innerHTML = ua;
      document.getElementById("ref").innerHTML = ref;

      var fs = window.RequestFileSystem || window.webkitRequestFileSystem;
      if (!fs) {
          // no such function, ignore
      } else {
          fs(window.TEMPORARY, 100,
             function(fs) {
                document.getElementById("browser-mode").innerHTML = 'Normal';
             }, function(err) {
                document.getElementById("browser-mode").innerHTML = 'Incognito';
             }
          );
      };

      // Feature detects Navigation Timing API support.
      if (window.performance) {
        // Gets the number of milliseconds since page load
        // (and rounds the result since the value must be an integer).
        var timeSincePageLoad = Math.round(performance.now());
        document.getElementById("window-performance").innerHTML = timeSincePageLoad;
        console.log(window.performance);
        console.log(navigator.connection);

        gtag('event', 'timing_complete', {
          'name': 'load',
          'value': timeSincePageLoad,
          'event_category': 'JS Dependencies'
        });
      }
    </script>
    <!-- <script>
      function isPrivateMode() {
        return new Promise((resolve) => {
          const on = () => resolve(true); // is in private mode
          const off = () => resolve(false); // not private mode
          const testLocalStorage = () => {
            try {
              if (localStorage.length) off();
              else {
                localStorage.x = 1;
                localStorage.removeItem('x');
                off();
              }
            } catch (e) {
              // Safari only enables cookie in private mode
              // if cookie is disabled then all client side storage is disabled
              // if all client side storage is disabled, then there is no point
              // in using private mode
              navigator.cookieEnabled ? on() : off();
            }
          };
          // Chrome & Opera
          if (window.webkitRequestFileSystem) {
            return void window.webkitRequestFileSystem(0, 0, off, on);
          }
          // Firefox
          if ('MozAppearance' in document.documentElement.style) {
            const db = indexedDB.open('test');
            db.onerror = on;
            db.onsuccess = off;
            return void 0;
          }
          // Safari
          if (/constructor/i.test(window.HTMLElement)) {
            return testLocalStorage();
          }
          // IE10+ & Edge
          if (!window.indexedDB && (window.PointerEvent || window.MSPointerEvent)) {
            return on();
          }
          // others
          return off();
        });
      }

      isPrivateMode().then((isPrivate) => {
        console.log('Is in private mode: ', isPrivate);
        if (isPrivate == true) {
          document.getElementById("browser-mode").innerHTML = 'Incognito';
        }
        else {
         document.getElementById("browser-mode").innerHTML = 'Normal'; 
        }
      });
    </script> -->
    <script>
      function retry(isDone, next) {
    var current_trial = 0, max_retry = 50, interval = 10, is_timeout = false;
    var id = window.setInterval(
        function() {
            if (isDone()) {
                window.clearInterval(id);
                next(is_timeout);
            }
            if (current_trial++ > max_retry) {
                window.clearInterval(id);
                is_timeout = true;
                next(is_timeout);
            }
        },
        10
    );
}

function isIE10OrLater(user_agent) {
    var ua = user_agent.toLowerCase();
    if (ua.indexOf('msie') === 0 && ua.indexOf('trident') === 0) {
        return false;
    }
    var match = /(?:msie|rv:)\s?([\d\.]+)/.exec(ua);
    if (match && parseInt(match[1], 10) >= 10) {
        return true;
    }
    return false;
}

function detectPrivateMode(callback) {
    var is_private;

    if (window.webkitRequestFileSystem) {
        window.webkitRequestFileSystem(
            window.TEMPORARY, 1,
            function() {
                is_private = false;
            },
            function(e) {
                console.log(e);
                is_private = true;
            }
        );
    } else if (window.indexedDB && /Firefox/.test(window.navigator.userAgent)) {
        var db;
        try {
            db = window.indexedDB.open('test');
        } catch(e) {
            is_private = true;
        }

        if (typeof is_private === 'undefined') {
            retry(
                function isDone() {
                    return db.readyState === 'done' ? true : false;
                },
                function next(is_timeout) {
                    if (!is_timeout) {
                        is_private = db.result ? false : true;
                    }
                }
            );
        }
    } else if (isIE10OrLater(window.navigator.userAgent)) {
        is_private = false;
        try {
            if (!window.indexedDB) {
                is_private = true;
            }                 
        } catch (e) {
            is_private = true;
        }
    } else if (window.localStorage && /Safari/.test(window.navigator.userAgent)) {
        try {
            window.localStorage.setItem('test', 1);
        } catch(e) {
            is_private = true;
        }

        if (typeof is_private === 'undefined') {
            is_private = false;
            window.localStorage.removeItem('test');
        }
    }

    retry(
        function isDone() {
            return typeof is_private !== 'undefined' ? true : false;
        },
        function next(is_timeout) {
            callback(is_private);
        }
    );
}


detectPrivateMode(
        function(is_private) {
            document.getElementById('browser-mode').innerHTML = typeof is_private === 'undefined' ? 'cannot detect' : is_private ? 'private' : 'not private';
        }
    );
    </script>
    <script>
try {
// try to use localStorage
localStorage.test = 2;        
} catch (e) {
// there was an error so...
document.getElementById("browser-mode1").innerHTML = 'You are in Privacy Mode. Please deactivate Privacy Mode and then reload the page.';
// alert('You are in Privacy Mode\nPlease deactivate Privacy Mode and then reload the page.');
}
    </script>
  </body>
</html>